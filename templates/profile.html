{% extends "base.html" %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-info">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="profile-details">
                <h2>{{ user.username }}</h2>
                <p>{{ user.email }}</p>
                <p>Регистрация: {{ user.created_at.strftime('%d.%m.%Y') }}</p>
            </div>
        </div>
        <div class="profile-balance">
            <div class="balance-card">
                <i class="fas fa-wallet"></i>
                <div class="balance-info">
                    <span class="balance-label">Баланс</span>
                    <span class="balance-amount">{{ "%.2f"|format(user.balance) }}₽</span>
                </div>
            </div>
        </div>
    </div>

    <div class="profile-stats">
        <div class="stat-card">
            <i class="fas fa-gamepad"></i>
            <div class="stat-info">
                <span class="stat-value">{{ bets|length }}</span>
                <span class="stat-label">Всего игр</span>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-trophy"></i>
            <div class="stat-info">
                <span class="stat-value">{{ bets|selectattr('result', 'equalto', 'win')|list|length }}</span>
                <span class="stat-label">Выигрышей</span>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-chart-line"></i>
            <div class="stat-info">
                <span class="stat-value">{{ "%.1f"|format((bets|selectattr('result', 'equalto', 'win')|list|length / bets|length * 100) if bets|length > 0 else 0) }}%</span>
                <span class="stat-label">Винрейт</span>
            </div>
        </div>
    </div>

    <div class="bet-history">
        <h3>История ставок</h3>
        <div class="history-table">
            <div class="table-header">
                <div class="col">Дата</div>
                <div class="col">Ставка</div>
                <div class="col">Сумма</div>
                <div class="col">Результат</div>
                <div class="col">Выплата</div>
            </div>
            {% for bet in bets %}
            <div class="table-row {{ 'win' if bet.result == 'win' else 'lose' }}">
                <div class="col">{{ bet.created_at.strftime('%d.%m %H:%M') }}</div>
                <div class="col">
                    <span class="bet-type {{ bet.bet_type }}">{{ bet.bet_type.upper() }}</span>
                </div>
                <div class="col">{{ "%.2f"|format(bet.amount) }}₽</div>
                <div class="col">
                    <span class="result {{ bet.result }}">
                        {% if bet.result == 'win' %}
                            <i class="fas fa-check"></i> Выигрыш
                        {% else %}
                            <i class="fas fa-times"></i> Проигрыш
                        {% endif %}
                    </span>
                </div>
                <div class="col">
                    {% if bet.payout > 0 %}
                        +{{ "%.2f"|format(bet.payout) }}₽
                    {% else %}
                        -{{ "%.2f"|format(bet.amount) }}₽
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
